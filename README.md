# MyGames V2 - 摸鱼游戏管理平台

MyGames V2 是一个基于 React + Node.js + SQLite 构建的高性能 H5 游戏管理平台。它不仅支持游戏的上传、展示和在线游玩，还集成了完善的用户系统、云存档功能以及企业级的安全防护机制。

## 🌟 核心特性

### 🎮 游戏管理
- **极速上传**：支持 ZIP 压缩包一键上传，系统自动解压并分类资源。
- **大文件支持**：内置**切片上传**机制，支持最高 **2GB** 的超大游戏文件，并提供实时进度反馈。
- **智能兼容**：自动修复 Cocos Creator 等引擎的目录结构问题（如 `assets/internal` 路径修正）。
- **统计分析**：实时记录游戏点击量、点赞数，支持置顶管理。

### 🛡️ 安全与认证
- **双重验证 (MFA)**：管理员后台支持 **TOTP (Google Authenticator)** 二步验证，极大提升账户安全性。
- **邀请注册制**：用户注册需凭**唯一邀请码**，邀请码支持后台批量生成与管理。
- **强制改密**：管理员首次登录必须修改默认密码，确保初始环境安全。
- **JWT 鉴权**：全站接口基于 JWT 令牌，支持管理员与普通用户权限隔离。

### 💾 云存档系统
- **跨端同步**：支持游戏存档云端上传与下载，随时随地继续游戏。
- **自动存档**：可开启自动存档功能，系统定时同步游戏进度。

### 🚀 部署与运维
- **一键部署**：提供 `deploy.sh` 脚本，自动化完成依赖安装、项目构建及服务启动。
- **全栈集成**：后端 Node.js 服务直接托管前端静态文件，无需额外配置 Nginx 即可运行。
- **SPA 优化**：完善的路由拦截处理，支持页面刷新与直接访问子路径。

## 🛠️ 技术栈

- **前端**：React 18, TypeScript, Vite, Ant Design 5, Zustand, Axios
- **后端**：Node.js, Express, TypeScript, SQLite (sql.js), JWT, Speakeasy (MFA)
- **运维**：PM2, Shell Script

## 📂 项目结构

```text
MyGamesV2/
├── packages/
│   ├── backend/          # 后端服务 (Express + TypeScript)
│   │   ├── src/
│   │   │   ├── controllers/ # 业务逻辑
│   │   │   ├── middlewares/ # 鉴权、MFA、上传中间件
│   │   │   ├── routes/      # 路由定义
│   │   │   └── config/      # 系统配置
│   │   └── data/            # 数据库文件存放处
│   └── frontend/         # 前端应用 (React + Vite)
│       ├── src/
│       │   ├── pages/       # 页面组件 (含管理后台)
│       │   ├── services/    # API 服务封装
│       │   └── stores/      # 状态管理 (Zustand)
├── public/               # 静态资源目录 (游戏文件、图片)
├── deploy.sh             # 一键部署脚本
└── ecosystem.config.js   # PM2 配置文件
```

## 🚦 快速开始

### 开发环境运行

1. **安装依赖**：
   ```bash
   npm install
   ```

2. **初始化数据库**：
   ```bash
   npm run db:migrate
   ```

3. **启动开发服务器**：
   ```bash
   npm run dev
   ```
   - 前端：`http://localhost:5173`
   - 后端 API：`http://localhost:3001`

### 生产环境部署

我们推荐使用提供的一键部署脚本（适用于 Linux）：

```bash
chmod +x deploy.sh
./deploy.sh
```

脚本会自动完成：
- 前后端代码打包
- 目录结构创建
- 数据库迁移
- 使用 PM2 启动服务（如果已安装）

## 🔐 安全配置说明

### 1. 管理员初始账号
- **用户名**：`admin`
- **初始密码**：`admin123`
- *注意：首次登录后系统会强制要求修改密码。*

### 2. 开启 MFA 验证
1. 登录管理后台，进入 **"安全设置"** 菜单。
2. 点击 **"开始配置"**，使用手机 App（如 Google Authenticator）扫描二维码。
3. 输入手机生成的 6 位验证码完成绑定。
4. 绑定成功后，下次登录将强制要求输入动态验证码。

### 3. 邀请码管理
管理员可在后台 **"邀请码管理"** 页面批量生成邀请码。只有持有有效邀请码的用户才能完成注册。

## 📝 运维建议

- **Nginx 配置**：建议在 Nginx 中设置 `client_max_body_size 2048M;` 以支持大文件上传。
- **备份**：定期备份 `data/mygames.db` 文件及 `public/` 目录下的游戏资源。

---
🎮 *摸鱼大全 - 让快乐更简单*
